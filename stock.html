<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨è¿½è¹¤å°å¡ç³»çµ± | æŠ•è³‡ç¤¾ç¾¤èˆ‡åˆ†æå¹³å°</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0"></script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #8b5cf6;
            --ig-color: #E4405F;
            --facebook-color: #1877F2;
            --twitter-color: #1DA1F2;
            --threads-color: #000000;
            --forum-color: #8b5cf6;
            --bg-color: #f8fafc;
            --card-color: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background: var(--bg-color);
            color: var(--text-primary);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e40af 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .market-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .stat-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
        }
        
        /* å·¦å´ï¼šæ–°å¢å°å¡è¡¨å–® */
        .form-section {
            background: var(--card-color);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .form-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .required::after {
            content: " *";
            color: var(--danger-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: var(--card-color);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        /* å³å´ï¼šç¯©é¸å’Œæœç´¢ */
        .filter-section {
            background: var(--card-color);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .search-box {
            margin-bottom: 25px;
        }
        
        .search-input {
            position: relative;
        }
        
        .search-input i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .search-input input {
            padding-left: 45px;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .date-range {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        /* æ“ä½œæŒ‰éˆ• */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--border-color);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background: #cbd5e1;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn-info {
            background: var(--info-color);
            color: white;
        }
        
        .btn-forum {
            background: var(--forum-color);
            color: white;
        }
        
        /* ä¸»å…§å®¹å€ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-top: 30px;
        }
        
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* å·¦å´ï¼šè‚¡ç¥¨å°å¡ç¶²æ ¼ */
        .cards-section {
            background: var(--card-color);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        @media (max-width: 900px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* å³å´ï¼šçµ±è¨ˆèˆ‡ç¤¾ç¾¤ */
        .sidebar-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        /* è‚¡ç¥¨å°å¡æ¨£å¼ */
        .stock-card {
            background: var(--card-color);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }
        
        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        .stock-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .stock-symbol {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stock-name {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 5px;
        }
        
        .market-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-us {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-hk {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
            display: inline-block;
        }
        
        .status-buy {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-sell {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-watch {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-discuss {
            background: #e0f2fe;
            color: #0369a1;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .card-section {
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 13px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 10px;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .price-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .price-item {
            background: var(--bg-color);
            padding: 12px;
            border-radius: 8px;
        }
        
        .price-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .price-value {
            font-size: 18px;
            font-weight: 600;
        }
        
        .price-buy {
            color: var(--danger-color);
        }
        
        .price-sell {
            color: var(--success-color);
        }
        
        .target-price {
            color: var(--primary-color);
        }
        
        .progress-container {
            margin-top: 10px;
        }
        
        .progress-bar {
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .progress-buy {
            background: var(--danger-color);
        }
        
        .progress-sell {
            background: var(--success-color);
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .reason-box {
            background: var(--bg-color);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-primary);
        }
        
        /* è‚¡åƒ¹èµ°å‹¢åœ– */
        .chart-container {
            height: 200px;
            margin-top: 15px;
            position: relative;
        }
        
        .chart-legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 11px;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-buy {
            background-color: var(--danger-color);
        }
        
        .legend-sell {
            background-color: var(--success-color);
        }
        
        .card-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-color);
        }
        
        .date-info {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: white;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        .icon-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* åˆ†äº«æŒ‰éˆ• */
        .share-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        
        .share-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s ease;
            color: white;
        }
        
        .share-btn-ig {
            background: var(--ig-color);
        }
        
        .share-btn-fb {
            background: var(--facebook-color);
        }
        
        .share-btn-twitter {
            background: var(--twitter-color);
        }
        
        .share-btn-threads {
            background: var(--threads-color);
        }
        
        .share-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* çµ±è¨ˆå¡ç‰‡ */
        .stats-card {
            background: var(--card-color);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .time-tabs {
            display: flex;
            background: var(--border-color);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }
        
        .time-tab {
            flex: 1;
            padding: 8px;
            text-align: center;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .time-tab.active {
            background: var(--card-color);
            color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .stat-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .stat-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .stat-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .positive {
            color: var(--success-color);
        }
        
        .negative {
            color: var(--danger-color);
        }
        
        .neutral {
            color: var(--text-secondary);
        }
        
        .stat-details {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .stat-chart {
            height: 60px;
            margin-top: 10px;
        }
        
        /* ç•™è¨€æ¿ */
        .forum-card {
            background: var(--card-color);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            max-height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .forum-header {
            margin-bottom: 20px;
        }
        
        .forum-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--forum-color);
            margin-bottom: 5px;
        }
        
        .forum-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .message-item {
            background: var(--bg-color);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 3px solid var(--forum-color);
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .message-user {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .user-location {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .message-time {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .message-content {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .message-stock {
            display: inline-block;
            background: var(--border-color);
            color: var(--primary-color);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .new-message-form {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        /* ç©ºç‹€æ…‹ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
        }
        
        .empty-icon {
            font-size: 48px;
            color: var(--border-color);
            margin-bottom: 20px;
        }
        
        .empty-text {
            color: var(--text-secondary);
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        /* åˆ†é æ¨™ç±¤ */
        .tabs {
            display: flex;
            background: var(--border-color);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 25px;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            text-align: center;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: 8px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .tab.active {
            background: var(--card-color);
            color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* æ¨¡æ…‹è¦–çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--card-color);
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 25px 25px 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-footer {
            padding: 15px 25px 25px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* å¯¦éš›åƒ¹æ ¼æ¨¡æ…‹ */
        .real-price-section {
            margin-bottom: 30px;
        }
        
        .price-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .price-source {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        /* å‹•ç•« */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* æ»¾å‹•æ¢ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }
        
        /* åƒ¹æ ¼æ›´æ–°æç¤º */
        .price-update {
            background: var(--bg-color);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid var(--warning-color);
        }
        
        .update-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: var(--warning-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1>ğŸ“Š è‚¡ç¥¨æŠ•è³‡ç¤¾ç¾¤å¹³å°</h1>
                    <p class="subtitle">è¨˜éŒ„æŠ•è³‡ç­†è¨˜ | è¿½è¹¤å¯¦éš›è‚¡åƒ¹ | äº¤æµæŠ•è³‡å¿ƒå¾—</p>
                </div>
                <div class="market-stats">
                    <div class="stat-badge">ç¾è‚¡: <span id="usCount">0</span> éš»</div>
                    <div class="stat-badge">æ¸¯è‚¡: <span id="hkCount">0</span> éš»</div>
                    <div class="stat-badge">ç•™è¨€: <span id="messageCount">0</span> å‰‡</div>
                </div>
            </div>
        </header>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <!-- å·¦å´ï¼šæ–°å¢è¡¨å–® -->
            <div class="form-section">
                <div class="form-title">
                    <i class="fas fa-plus-circle"></i>
                    æ–°å¢è‚¡ç¥¨è¿½è¹¤
                </div>
                
                <div class="form-group">
                    <label class="required">å¸‚å ´é¡å‹</label>
                    <select id="marketType" onchange="updateSymbolHint()">
                        <option value="us">ç¾è‚¡ (US Stock)</option>
                        <option value="hk">æ¸¯è‚¡ (HK Stock)</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">è‚¡ç¥¨ä»£è™Ÿ</label>
                        <input type="text" id="stockSymbol" placeholder="ä¾‹å¦‚: AAPL, 0700" maxlength="10" />
                        <div id="symbolHint" style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                            ç¾è‚¡: AAPL, TSLA | æ¸¯è‚¡: 0700, 9988
                        </div>
                    </div>
                    <div class="form-group">
                        <label>è‚¡ç¥¨åç¨± (é¸å¡«)</label>
                        <input type="text" id="stockName" placeholder="ä¾‹å¦‚: è˜‹æœå…¬å¸, é¨°è¨Š" />
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="required">äº¤æ˜“ç‹€æ…‹</label>
                    <select id="statusType" onchange="updatePriceFields()">
                        <option value="buy">è²·å…¥ (Buy)</option>
                        <option value="sell">è³£å‡º (Sell)</option>
                        <option value="watch">é—œæ³¨ä¸­ (Watching)</option>
                        <option value="discuss">è¨è«–ä¸­ (Discussing)</option>
                    </select>
                </div>
                
                <div class="price-input-group">
                    <div class="form-group">
                        <label id="priceLabel">è²·å…¥åƒ¹æ ¼ (USD/HKD)</label>
                        <input type="number" id="price" placeholder="0.00" step="0.01" min="0" />
                    </div>
                    <div class="form-group">
                        <label>ç›®æ¨™åƒ¹æ ¼ (é¸å¡«)</label>
                        <input type="number" id="targetPrice" placeholder="0.00" step="0.01" min="0" />
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ç›®æ¨™æ¼²è·Œå¹… (Â±%)</label>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="number" id="targetUp" placeholder="ä¸Šæ¼² %" step="0.1" min="0" />
                        </div>
                        <div class="form-group">
                            <input type="number" id="targetDown" placeholder="ä¸‹è·Œ %" step="0.1" min="0" />
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="required">äº¤æ˜“/é—œæ³¨æ—¥æœŸ</label>
                    <input type="date" id="transactionDate" />
                </div>
                
                <div class="form-group">
                    <label id="reasonLabel">è²·å…¥ç†ç”±</label>
                    <textarea id="reason" placeholder="è«‹è©³ç´°èªªæ˜è²·å…¥/è³£å‡º/é—œæ³¨/è¨è«–çš„åŸå› ..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>æ¨™ç±¤ (ç”¨é€—è™Ÿåˆ†éš”)</label>
                    <input type="text" id="tags" placeholder="ä¾‹å¦‚: AIæ¦‚å¿µ, é•·æœŸæŠ•è³‡, é«˜è‚¡æ¯" />
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="addStockCard()">
                        <i class="fas fa-save"></i> ä¿å­˜è‚¡ç¥¨è¨˜éŒ„
                    </button>
                    <button class="btn btn-secondary" onclick="clearForm()">
                        <i class="fas fa-redo"></i> æ¸…ç©º
                    </button>
                </div>
            </div>
            
            <!-- å³å´ï¼šç¯©é¸æœç´¢ -->
            <div class="filter-section">
                <div class="form-title">
                    <i class="fas fa-filter"></i>
                    ç¯©é¸èˆ‡æœç´¢
                </div>
                
                <div class="search-box">
                    <div class="search-input">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="æœå°‹è‚¡ç¥¨ä»£è™Ÿã€åç¨±æˆ–ç†ç”±..." oninput="filterCards()" />
                    </div>
                </div>
                
                <div class="filter-grid">
                    <div class="form-group">
                        <label>å¸‚å ´é¡å‹</label>
                        <select id="filterMarket" onchange="filterCards()">
                            <option value="all">å…¨éƒ¨å¸‚å ´</option>
                            <option value="us">ç¾è‚¡</option>
                            <option value="hk">æ¸¯è‚¡</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>äº¤æ˜“ç‹€æ…‹</label>
                        <select id="filterStatus" onchange="filterCards()">
                            <option value="all">å…¨éƒ¨ç‹€æ…‹</option>
                            <option value="buy">è²·å…¥</option>
                            <option value="sell">è³£å‡º</option>
                            <option value="watch">é—œæ³¨ä¸­</option>
                            <option value="discuss">è¨è«–ä¸­</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>æ’åºæ–¹å¼</label>
                        <select id="sortBy" onchange="filterCards()">
                            <option value="date_desc">æ—¥æœŸ (æ–°åˆ°èˆŠ)</option>
                            <option value="date_asc">æ—¥æœŸ (èˆŠåˆ°æ–°)</option>
                            <option value="symbol_asc">è‚¡ç¥¨ä»£è™Ÿ A-Z</option>
                            <option value="symbol_desc">è‚¡ç¥¨ä»£è™Ÿ Z-A</option>
                            <option value="price_desc">åƒ¹æ ¼ (é«˜åˆ°ä½)</option>
                            <option value="price_asc">åƒ¹æ ¼ (ä½åˆ°é«˜)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>æ—¥æœŸç¯„åœç¯©é¸</label>
                    <div class="date-range">
                        <div class="form-group">
                            <input type="date" id="dateFrom" onchange="filterCards()" />
                        </div>
                        <div class="form-group">
                            <input type="date" id="dateTo" onchange="filterCards()" />
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="resetFilters()">
                        <i class="fas fa-times"></i> é‡ç½®ç¯©é¸
                    </button>
                    <button class="btn btn-info" onclick="showShareModal()">
                        <i class="fas fa-share-alt"></i> åˆ†äº«æŠ•è³‡çµ„åˆ
                    </button>
                    <button class="btn btn-forum" onclick="showForum()">
                        <i class="fas fa-comments"></i> æŸ¥çœ‹ç•™è¨€æ¿
                    </button>
                </div>
            </div>
        </div>

        <!-- åˆ†é æ¨™ç±¤ -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('all')">å…¨éƒ¨è‚¡ç¥¨</button>
            <button class="tab" onclick="showTab('buy')">è²·å…¥è¨˜éŒ„</button>
            <button class="tab" onclick="showTab('sell')">è³£å‡ºè¨˜éŒ„</button>
            <button class="tab" onclick="showTab('watch')">é—œæ³¨ä¸­</button>
            <button class="tab" onclick="showTab('chart')">è‚¡åƒ¹èµ°å‹¢</button>
        </div>

        <!-- ä¸»å…§å®¹å€ -->
        <div class="main-content">
            <!-- å·¦å´ï¼šè‚¡ç¥¨å°å¡ç¶²æ ¼ -->
            <div class="cards-section">
                <div id="cardsGrid">
                    <!-- è‚¡ç¥¨å°å¡æœƒå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="empty-text">å°šæœªæ·»åŠ ä»»ä½•è‚¡ç¥¨è¿½è¹¤è¨˜éŒ„</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">
                            é»æ“Šä¸Šæ–¹è¡¨å–®é–‹å§‹è¨˜éŒ„ä½ çš„æŠ•è³‡ç­†è¨˜
                        </p>
                        <button class="btn btn-primary" onclick="addSampleData()">
                            <i class="fas fa-magic"></i> æ·»åŠ ç¤ºä¾‹æ•¸æ“š
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- å³å´ï¼šçµ±è¨ˆèˆ‡ç¤¾ç¾¤ -->
            <div class="sidebar-section">
                <!-- æŠ•è³‡å›é¡§çµ±è¨ˆ -->
                <div class="stats-card">
                    <div class="form-title">
                        <i class="fas fa-chart-bar"></i>
                        æŠ•è³‡å›é¡§çµ±è¨ˆ
                    </div>
                    
                    <div class="time-tabs">
                        <button class="time-tab active" onclick="showTimeStats('daily')">æœ¬æ—¥</button>
                        <button class="time-tab" onclick="showTimeStats('weekly')">æœ¬é€±</button>
                        <button class="time-tab" onclick="showTimeStats('monthly')">æœ¬æœˆ</button>
                        <button class="time-tab" onclick="showTimeStats('yearly')">ä»Šå¹´</button>
                    </div>
                    
                    <div id="timeStats">
                        <!-- æ™‚é–“çµ±è¨ˆæœƒå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
                        <div class="empty-state" style="padding: 20px;">
                            <div class="empty-text">æš«ç„¡çµ±è¨ˆæ•¸æ“š</div>
                        </div>
                    </div>
                </div>
                
                <!-- æŠ•è³‡ç¤¾ç¾¤ç•™è¨€æ¿ -->
                <div class="forum-card">
                    <div class="forum-header">
                        <div class="forum-title">
                            <i class="fas fa-comments"></i>
                            æŠ•è³‡ç¤¾ç¾¤ç•™è¨€æ¿
                        </div>
                        <div class="forum-subtitle">
                            èˆ‡å…¨çƒæŠ•è³‡è€…äº¤æµå¿ƒå¾—
                        </div>
                    </div>
                    
                    <div class="messages-container" id="messagesContainer">
                        <!-- ç•™è¨€æœƒå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
                        <div class="empty-state" style="padding: 20px;">
                            <div class="empty-text">æš«ç„¡ç•™è¨€</div>
                        </div>
                    </div>
                    
                    <div class="new-message-form">
                        <div class="form-group">
                            <textarea id="newMessage" placeholder="åˆ†äº«ä½ çš„æŠ•è³‡å¿ƒå¾—æˆ–çœ‹æ³•..." rows="2"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <input type="text" id="userName" placeholder="ä½ çš„åå­—" />
                            </div>
                            <div class="form-group">
                                <input type="text" id="userLocation" placeholder="åœ°å€ (å¦‚: é¦™æ¸¯, å°ç£)" />
                            </div>
                        </div>
                        <button class="btn btn-forum" onclick="addNewMessage()" style="width: 100%;">
                            <i class="fas fa-paper-plane"></i> ç™¼å¸ƒç•™è¨€
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç·¨è¼¯æ¨¡æ…‹è¦–çª— -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ç·¨è¼¯è‚¡ç¥¨è¨˜éŒ„</div>
            </div>
            <div class="modal-body">
                <!-- ç·¨è¼¯è¡¨å–®æœƒå‹•æ…‹æ’å…¥é€™è£¡ -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-success" onclick="saveEdit()">ä¿å­˜æ›´æ”¹</button>
            </div>
        </div>
    </div>

    <!-- å¯¦éš›è‚¡åƒ¹æ›´æ–°æ¨¡æ…‹ -->
    <div class="modal" id="priceUpdateModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-chart-line"></i>
                    æ›´æ–°å¯¦éš›è‚¡åƒ¹
                </div>
            </div>
            <div class="modal-body">
                <div class="real-price-section">
                    <h4 style="margin-bottom: 15px; color: var(--primary-color);" id="priceUpdateTitle">
                        æ›´æ–°è‚¡ç¥¨åƒ¹æ ¼
                    </h4>
                    <div class="price-input-group">
                        <div class="form-group">
                            <label>ç•¶å‰å¯¦éš›åƒ¹æ ¼</label>
                            <input type="number" id="currentRealPrice" step="0.01" min="0" />
                        </div>
                        <div class="form-group">
                            <label>æ›´æ–°æ—¥æœŸ</label>
                            <input type="date" id="priceUpdateDate" />
                        </div>
                    </div>
                    <div class="price-source">
                        <label>åƒ¹æ ¼ä¾†æº</label>
                        <select id="priceSource">
                            <option value="yahoo">Yahoo Finance</option>
                            <option value="google">Google Finance</option>
                            <option value="bloomberg">Bloomberg</option>
                            <option value="reuters">Reuters</option>
                            <option value="other">å…¶ä»–ä¾†æº</option>
                        </select>
                    </div>
                </div>
                
                <div class="price-update">
                    <div style="font-weight: 600; color: var(--warning-color); margin-bottom: 10px;">
                        <i class="fas fa-exclamation-circle"></i>
                        åƒ¹æ ¼æ›´æ–°è¨˜éŒ„
                    </div>
                    <div id="priceHistory">
                        <!-- åƒ¹æ ¼æ­·å²æœƒå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePriceUpdateModal()">å–æ¶ˆ</button>
                <button class="btn btn-success" onclick="saveRealPrice()">æ›´æ–°åƒ¹æ ¼</button>
            </div>
        </div>
    </div>

    <!-- è‚¡åƒ¹èµ°å‹¢åœ–æ¨¡æ…‹ -->
    <div class="modal" id="chartModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-chart-line"></i>
                    <span id="chartModalTitle">è‚¡åƒ¹èµ°å‹¢åœ–</span>
                </div>
            </div>
            <div class="modal-body">
                <div class="chart-container" style="height: 400px;">
                    <canvas id="detailedChart"></canvas>
                </div>
                <div class="chart-legend" style="margin-top: 20px; justify-content: flex-start;">
                    <div class="legend-item">
                        <div class="legend-color legend-buy"></div>
                        <span>è²·å…¥é»</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-sell"></div>
                        <span>è³£å‡ºé»</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 12px; height: 2px; background: #3b82f6;"></div>
                        <span>å¯¦éš›è‚¡åƒ¹</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 12px; height: 2px; background: #f59e0b; border-style: dashed;"></div>
                        <span>æ¨¡æ“¬è‚¡åƒ¹</span>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <div class="section-title">
                        <i class="fas fa-list"></i>
                        äº¤æ˜“è¨˜éŒ„
                    </div>
                    <div id="transactionList">
                        <!-- äº¤æ˜“è¨˜éŒ„æœƒå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeChartModal()">é—œé–‰</button>
                <button class="btn btn-primary" onclick="updateRealPriceForChart()">
                    <i class="fas fa-sync-alt"></i> æ›´æ–°å¯¦éš›è‚¡åƒ¹
                </button>
            </div>
        </div>
    </div>

    <script>
        // è‚¡ç¥¨å°å¡æ•¸æ“š
        let stockCards = JSON.parse(localStorage.getItem('stockCards')) || [];
        let forumMessages = JSON.parse(localStorage.getItem('forumMessages')) || [];
        let stockPrices = JSON.parse(localStorage.getItem('stockPrices')) || {};
        let currentEditId = null;
        let currentTab = 'all';
        let currentTimeStats = 'daily';
        let detailedChart = null;
        let currentChartSymbol = '';

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­å®šä»Šå¤©æ—¥æœŸç‚ºé è¨­
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transactionDate').value = today;
            document.getElementById('priceUpdateDate').value = today;
            
            // åˆå§‹åŒ–ç¯©é¸æ—¥æœŸ
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            document.getElementById('dateFrom').value = oneMonthAgo.toISOString().split('T')[0];
            document.getElementById('dateTo').value = today;
            
            // æ›´æ–°çµ±è¨ˆ
            updateStats();
            
            // è¼‰å…¥ä¸¦é¡¯ç¤ºå°å¡
            renderCards();
            
            // è¼‰å…¥ç•™è¨€æ¿
            renderForumMessages();
            
            // è¼‰å…¥æ™‚é–“çµ±è¨ˆ
            renderTimeStats();
            
            // æ›´æ–°è¡¨å–®æç¤º
            updateSymbolHint();
            updatePriceFields();
        });

        // æ›´æ–°è‚¡ç¥¨ä»£è™Ÿæç¤º
        function updateSymbolHint() {
            const marketType = document.getElementById('marketType').value;
            const hintElement = document.getElementById('symbolHint');
            
            if (marketType === 'us') {
                hintElement.textContent = 'ç¾è‚¡ä»£è™Ÿ: AAPL (è˜‹æœ), TSLA (ç‰¹æ–¯æ‹‰), NVDA (è¼é”)';
                document.getElementById('price').placeholder = 'USD';
            } else {
                hintElement.textContent = 'æ¸¯è‚¡ä»£è™Ÿ: 0700 (é¨°è¨Š), 9988 (é˜¿é‡Œå·´å·´), 0005 (åŒ¯è±)';
                document.getElementById('price').placeholder = 'HKD';
            }
        }

        // æ ¹æ“šäº¤æ˜“ç‹€æ…‹æ›´æ–°åƒ¹æ ¼æ¬„ä½
        function updatePriceFields() {
            const statusType = document.getElementById('statusType').value;
            const priceLabel = document.getElementById('priceLabel');
            const reasonLabel = document.getElementById('reasonLabel');
            const priceInput = document.getElementById('price');
            
            const labels = {
                'buy': { price: 'è²·å…¥åƒ¹æ ¼ (USD/HKD)', reason: 'è²·å…¥ç†ç”±' },
                'sell': { price: 'è³£å‡ºåƒ¹æ ¼ (USD/HKD)', reason: 'è³£å‡ºç†ç”±' },
                'watch': { price: 'ç•¶å‰é—œæ³¨åƒ¹æ ¼ (USD/HKD)', reason: 'é—œæ³¨ç†ç”±' },
                'discuss': { price: 'è¨è«–åƒ¹æ ¼ (USD/HKD)', reason: 'è¨è«–é‡é»' }
            };
            
            priceLabel.textContent = labels[statusType].price;
            reasonLabel.textContent = labels[statusType].reason;
            
            // å¦‚æœæ˜¯é—œæ³¨æˆ–è¨è«–ç‹€æ…‹ï¼Œåƒ¹æ ¼æ”¹ç‚ºé¸å¡«
            if (statusType === 'watch' || statusType === 'discuss') {
                priceInput.placeholder = 'é¸å¡«';
            } else {
                priceInput.placeholder = '0.00';
            }
        }

        // æ–°å¢è‚¡ç¥¨å°å¡
        function addStockCard() {
            const marketType = document.getElementById('marketType').value;
            const symbol = document.getElementById('stockSymbol').value.trim().toUpperCase();
            const stockName = document.getElementById('stockName').value.trim();
            const statusType = document.getElementById('statusType').value;
            const price = parseFloat(document.getElementById('price').value) || 0;
            const targetPrice = parseFloat(document.getElementById('targetPrice').value) || 0;
            const targetUp = parseFloat(document.getElementById('targetUp').value) || 0;
            const targetDown = parseFloat(document.getElementById('targetDown').value) || 0;
            const date = document.getElementById('transactionDate').value;
            const reason = document.getElementById('reason').value.trim();
            const tags = document.getElementById('tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);

            // é©—è­‰å¿…å¡«æ¬„ä½
            if (!symbol || !date || !reason) {
                alert('è«‹å¡«å¯«è‚¡ç¥¨ä»£è™Ÿã€æ—¥æœŸå’Œç†ç”±');
                return;
            }

            // è¨ˆç®—ç›®æ¨™æ¼²è·Œå¹…
            let progress = 0;
            if (price > 0 && targetPrice > 0) {
                if (statusType === 'buy') {
                    // è²·å…¥ï¼šè¨ˆç®—è·é›¢ç›®æ¨™åƒ¹æ ¼çš„æ¼²å¹…
                    progress = Math.min(((targetPrice - price) / price * 100), 100);
                } else if (statusType === 'sell') {
                    // è³£å‡ºï¼šè¨ˆç®—è·é›¢ç›®æ¨™åƒ¹æ ¼çš„è·Œå¹…
                    progress = Math.min(((price - targetPrice) / price * 100), 100);
                }
            }

            const stockCard = {
                id: Date.now(),
                market: marketType,
                symbol: symbol,
                name: stockName || symbol,
                status: statusType,
                price: price,
                targetPrice: targetPrice,
                targetUp: targetUp,
                targetDown: targetDown,
                progress: Math.max(0, progress),
                date: date,
                reason: reason,
                tags: tags,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            stockCards.push(stockCard);
            saveToLocalStorage();
            renderCards();
            updateStats();
            renderTimeStats();
            clearForm();
            
            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            showNotification(`æˆåŠŸæ·»åŠ  ${symbol} è‚¡ç¥¨è¨˜éŒ„ï¼`, 'success');
        }

        // æ¸…ç©ºè¡¨å–®
        function clearForm() {
            document.getElementById('stockSymbol').value = '';
            document.getElementById('stockName').value = '';
            document.getElementById('price').value = '';
            document.getElementById('targetPrice').value = '';
            document.getElementById('targetUp').value = '';
            document.getElementById('targetDown').value = '';
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('reason').value = '';
            document.getElementById('tags').value = '';
        }

        // æ¸²æŸ“è‚¡ç¥¨å°å¡
        function renderCards(filteredCards = null) {
            const cards = filteredCards || stockCards;
            const container = document.getElementById('cardsGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (cards.length === 0 || (currentTab === 'chart' && cards.length === 0)) {
                container.innerHTML = `
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="empty-text">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„è‚¡ç¥¨</h3>
                        <button class="btn btn-secondary" onclick="resetFilters()">
                            <i class="fas fa-redo"></i> æ¸…é™¤ç¯©é¸æ¢ä»¶
                        </button>
                    </div>
                `;
                return;
            }
            
            // éš±è—ç©ºç‹€æ…‹
            emptyState.style.display = 'none';
            
            // æ ¹æ“šç•¶å‰åˆ†é ç¯©é¸
            let filteredByTab = cards;
            if (currentTab === 'buy' || currentTab === 'sell' || currentTab === 'watch' || currentTab === 'discuss') {
                filteredByTab = cards.filter(card => card.status === currentTab);
            } else if (currentTab === 'chart') {
                // é¡¯ç¤ºè‚¡åƒ¹èµ°å‹¢åœ–çš„ç‰¹æ®Šè¦–åœ–
                renderStockCharts(cards);
                return;
            }
            
            // æ’åº
            const sortBy = document.getElementById('sortBy').value;
            filteredByTab.sort((a, b) => {
                switch(sortBy) {
                    case 'date_desc':
                        return new Date(b.date) - new Date(a.date);
                    case 'date_asc':
                        return new Date(a.date) - new Date(b.date);
                    case 'symbol_asc':
                        return a.symbol.localeCompare(b.symbol);
                    case 'symbol_desc':
                        return b.symbol.localeCompare(a.symbol);
                    case 'price_desc':
                        return b.price - a.price;
                    case 'price_asc':
                        return a.price - b.price;
                    default:
                        return new Date(b.date) - new Date(a.date);
                }
            });
            
            container.innerHTML = filteredByTab.map(card => {
                // ç²å–å¯¦éš›è‚¡åƒ¹
                const realPrice = getRealPrice(card.symbol);
                const showPriceUpdate = realPrice && realPrice.currentPrice;
                
                return `
                    <div class="stock-card fade-in" data-id="${card.id}">
                        <div class="card-header">
                            <div class="stock-info">
                                <div>
                                    <div class="stock-symbol">${card.symbol}</div>
                                    <div class="stock-name">${card.name}</div>
                                </div>
                                <div class="market-badge badge-${card.market}">
                                    ${card.market === 'us' ? 'ç¾è‚¡' : 'æ¸¯è‚¡'}
                                </div>
                            </div>
                            <div class="status-badge status-${card.status}">
                                ${getStatusText(card.status)}
                            </div>
                        </div>
                        
                        <div class="card-body">
                            <!-- åƒ¹æ ¼ä¿¡æ¯ -->
                            <div class="card-section">
                                <div class="section-title">
                                    <i class="fas fa-dollar-sign"></i>
                                    åƒ¹æ ¼ä¿¡æ¯
                                </div>
                                <div class="price-info">
                                    <div class="price-item">
                                        <div class="price-label">${card.status === 'buy' ? 'è²·å…¥åƒ¹' : card.status === 'sell' ? 'è³£å‡ºåƒ¹' : 'åƒè€ƒåƒ¹'}</div>
                                        <div class="price-value price-${card.status}">$${card.price.toFixed(2)}</div>
                                    </div>
                                    ${card.targetPrice > 0 ? `
                                    <div class="price-item">
                                        <div class="price-label">ç›®æ¨™åƒ¹æ ¼</div>
                                        <div class="price-value target-price">$${card.targetPrice.toFixed(2)}</div>
                                    </div>
                                    ` : ''}
                                </div>
                                
                                ${showPriceUpdate ? `
                                <div class="price-update">
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 5px;">
                                        ç•¶å‰å¯¦éš›åƒ¹æ ¼: 
                                        <span style="font-weight: 600; color: ${realPrice.change >= 0 ? 'var(--success-color)' : 'var(--danger-color)'}">
                                            $${realPrice.currentPrice.toFixed(2)} (${realPrice.change >= 0 ? '+' : ''}${realPrice.change}%)
                                        </span>
                                    </div>
                                    <div style="font-size: 11px; color: var(--text-secondary);">
                                        æ›´æ–°æ™‚é–“: ${formatDateTime(realPrice.lastUpdated)}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${card.targetPrice > 0 && card.price > 0 ? `
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill progress-${card.status}" 
                                             style="width: ${Math.min(card.progress, 100)}%"></div>
                                    </div>
                                    <div class="progress-text">
                                        <span>ç•¶å‰: $${card.price.toFixed(2)}</span>
                                        <span>ç›®æ¨™: $${card.targetPrice.toFixed(2)}</span>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${(card.targetUp > 0 || card.targetDown > 0) ? `
                                <div style="margin-top: 10px; font-size: 12px; color: var(--text-secondary);">
                                    ${card.targetUp > 0 ? `<span style="color: var(--success-color);">â†‘ ç›®æ¨™ä¸Šæ¼²: ${card.targetUp}%</span>` : ''}
                                    ${card.targetDown > 0 ? `<span style="color: var(--danger-color); margin-left: 10px;">â†“ ç›®æ¨™æ­¢æ: ${card.targetDown}%</span>` : ''}
                                </div>
                                ` : ''}
                            </div>
                            
                            <!-- è‚¡åƒ¹èµ°å‹¢åœ– -->
                            <div class="card-section">
                                <div class="section-title">
                                    <i class="fas fa-chart-line"></i>
                                    è‚¡åƒ¹èµ°å‹¢åœ–
                                </div>
                                <div class="chart-container">
                                    <canvas id="miniChart-${card.id}"></canvas>
                                </div>
                                <div class="chart-legend">
                                    <div class="legend-item">
                                        <div class="legend-color legend-buy"></div>
                                        <span>è²·å…¥é»</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color legend-sell"></div>
                                        <span>è³£å‡ºé»</span>
                                    </div>
                                </div>
                                <button class="update-btn" onclick="showPriceUpdateModal('${card.symbol}', '${card.name}')">
                                    <i class="fas fa-sync-alt"></i> æ›´æ–°å¯¦éš›åƒ¹æ ¼
                                </button>
                            </div>
                            
                            <!-- äº¤æ˜“ç†ç”± -->
                            <div class="card-section">
                                <div class="section-title">
                                    <i class="fas fa-comment-dots"></i>
                                    ç†ç”±èˆ‡åˆ†æ
                                </div>
                                <div class="reason-box">
                                    ${card.reason}
                                </div>
                            </div>
                            
                            <!-- åˆ†äº«æŒ‰éˆ• -->
                            <div class="share-buttons">
                                <button class="share-btn share-btn-ig" onclick="shareStockCard('${card.id}', 'ig')">
                                    <i class="fab fa-instagram"></i> IG
                                </button>
                                <button class="share-btn share-btn-threads" onclick="shareStockCard('${card.id}', 'threads')">
                                    <i class="fab fa-threads"></i> Threads
                                </button>
                                <button class="share-btn share-btn-fb" onclick="shareStockCard('${card.id}', 'facebook')">
                                    <i class="fab fa-facebook"></i> FB
                                </button>
                            </div>
                            
                            <!-- æ¨™ç±¤ -->
                            ${card.tags.length > 0 ? `
                            <div class="card-section">
                                <div class="section-title">
                                    <i class="fas fa-tags"></i>
                                    æ¨™ç±¤
                                </div>
                                <div class="tags-container">
                                    ${card.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="card-footer">
                            <div class="date-info">
                                <i class="far fa-calendar"></i> ${formatDate(card.date)}
                            </div>
                            <div class="card-actions">
                                <button class="icon-btn" onclick="showDetailedChart('${card.symbol}', '${card.name}')" title="æŸ¥çœ‹è©³ç´°èµ°å‹¢">
                                    <i class="fas fa-chart-line"></i>
                                </button>
                                <button class="icon-btn" onclick="editCard(${card.id})" title="ç·¨è¼¯">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="icon-btn" onclick="deleteCard(${card.id})" title="åˆªé™¤">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // ç‚ºæ¯å¼µå¡ç‰‡ç”Ÿæˆè¿·ä½ èµ°å‹¢åœ–
            filteredByTab.forEach(card => {
                setTimeout(() => {
                    renderMiniChart(card);
                }, 100);
            });
        }

        // ç²å–å¯¦éš›è‚¡åƒ¹
        function getRealPrice(symbol) {
            if (stockPrices[symbol]) {
                return stockPrices[symbol];
            }
            return null;
        }

        // é¡¯ç¤ºå¯¦éš›åƒ¹æ ¼æ›´æ–°æ¨¡æ…‹
        function showPriceUpdateModal(symbol, name) {
            currentChartSymbol = symbol;
            document.getElementById('priceUpdateTitle').textContent = `æ›´æ–° ${symbol} (${name}) åƒ¹æ ¼`;
            document.getElementById('priceUpdateDate').value = new Date().toISOString().split('T')[0];
            
            // é¡¯ç¤ºåƒ¹æ ¼æ­·å²
            const priceHistory = document.getElementById('priceHistory');
            if (stockPrices[symbol] && stockPrices[symbol].history) {
                priceHistory.innerHTML = stockPrices[symbol].history.map(record => `
                    <div style="font-size: 12px; margin-bottom: 5px;">
                        <span style="color: var(--text-primary);">${formatDateTime(record.date)}: </span>
                        <span style="font-weight: 600;">$${record.price.toFixed(2)}</span>
                        <span style="color: var(--text-secondary); margin-left: 10px;">${record.source}</span>
                    </div>
                `).join('');
            } else {
                priceHistory.innerHTML = '<div style="color: var(--text-secondary); font-size: 12px;">æš«ç„¡åƒ¹æ ¼è¨˜éŒ„</div>';
            }
            
            document.getElementById('priceUpdateModal').style.display = 'flex';
        }

        // ä¿å­˜å¯¦éš›åƒ¹æ ¼
        function saveRealPrice() {
            const symbol = currentChartSymbol;
            const price = parseFloat(document.getElementById('currentRealPrice').value);
            const date = document.getElementById('priceUpdateDate').value;
            const source = document.getElementById('priceSource').value;
            
            if (!price || price <= 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„åƒ¹æ ¼');
                return;
            }
            
            if (!stockPrices[symbol]) {
                stockPrices[symbol] = {
                    history: []
                };
            }
            
            // æ·»åŠ åƒ¹æ ¼è¨˜éŒ„
            stockPrices[symbol].history.push({
                price: price,
                date: date,
                source: source,
                updatedAt: new Date().toISOString()
            });
            
            // æ›´æ–°ç•¶å‰åƒ¹æ ¼
            const lastRecord = stockPrices[symbol].history[stockPrices[symbol].history.length - 1];
            const previousRecord = stockPrices[symbol].history[stockPrices[symbol].history.length - 2];
            
            stockPrices[symbol].currentPrice = lastRecord.price;
            stockPrices[symbol].lastUpdated = lastRecord.date;
            
            if (previousRecord) {
                const change = ((lastRecord.price - previousRecord.price) / previousRecord.price * 100).toFixed(2);
                stockPrices[symbol].change = parseFloat(change);
            } else {
                stockPrices[symbol].change = 0;
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
            localStorage.setItem('stockPrices', JSON.stringify(stockPrices));
            
            // é‡æ–°æ¸²æŸ“å¡ç‰‡
            renderCards();
            
            // é—œé–‰æ¨¡æ…‹
            closePriceUpdateModal();
            
            showNotification(`å·²æ›´æ–° ${symbol} åƒ¹æ ¼ç‚º $${price.toFixed(2)}`, 'success');
        }

        // é—œé–‰åƒ¹æ ¼æ›´æ–°æ¨¡æ…‹
        function closePriceUpdateModal() {
            document.getElementById('priceUpdateModal').style.display = 'none';
            document.getElementById('currentRealPrice').value = '';
        }

        // æ¸²æŸ“è¿·ä½ èµ°å‹¢åœ–ï¼ˆåŒ…å«å¯¦éš›åƒ¹æ ¼ï¼‰
        function renderMiniChart(card) {
            const canvas = document.getElementById(`miniChart-${card.id}`);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // ç²å–è©²è‚¡ç¥¨çš„æ‰€æœ‰äº¤æ˜“è¨˜éŒ„
            const stockTransactions = stockCards.filter(c => c.symbol === card.symbol);
            const buyPoints = stockTransactions.filter(t => t.status === 'buy');
            const sellPoints = stockTransactions.filter(t => t.status === 'sell');
            
            // ç²å–å¯¦éš›è‚¡åƒ¹æ•¸æ“š
            const realPriceData = stockPrices[card.symbol];
            
            // æº–å‚™åœ–è¡¨æ•¸æ“š
            let labels = [];
            let prices = [];
            let buyPointData = [];
            let sellPointData = [];
            
            if (realPriceData && realPriceData.history && realPriceData.history.length > 0) {
                // ä½¿ç”¨å¯¦éš›åƒ¹æ ¼æ•¸æ“š
                realPriceData.history.forEach((record, index) => {
                    labels.push(formatDate(record.date));
                    prices.push(record.price);
                    
                    // æª¢æŸ¥é€™å¤©æ˜¯å¦æœ‰äº¤æ˜“
                    const transaction = stockTransactions.find(t => 
                        t.date === record.date && 
                        (t.status === 'buy' || t.status === 'sell')
                    );
                    
                    if (transaction) {
                        if (transaction.status === 'buy') {
                            buyPointData[index] = transaction.price;
                            sellPointData[index] = null;
                        } else {
                            sellPointData[index] = transaction.price;
                            buyPointData[index] = null;
                        }
                    } else {
                        buyPointData[index] = null;
                        sellPointData[index] = null;
                    }
                });
            } else {
                // ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
                const days = 30;
                let basePrice = card.price;
                if (basePrice === 0 && stockTransactions.length > 0) {
                    basePrice = stockTransactions[0].price;
                }
                if (basePrice === 0) basePrice = 100;
                
                let currentPrice = basePrice;
                const today = new Date();
                
                for (let i = days - 1; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    labels.push(formatDate(date));
                    
                    // æ¨¡æ“¬åƒ¹æ ¼æ³¢å‹•
                    const change = (Math.random() * 0.06 - 0.03);
                    currentPrice = currentPrice * (1 + change);
                    prices.push(currentPrice);
                    
                    // æª¢æŸ¥é€™å¤©æ˜¯å¦æœ‰äº¤æ˜“
                    const transactionDate = formatDate(date);
                    const transaction = stockTransactions.find(t => 
                        formatDate(new Date(t.date)) === transactionDate && 
                        (t.status === 'buy' || t.status === 'sell')
                    );
                    
                    if (transaction) {
                        if (transaction.status === 'buy') {
                            buyPointData.push(transaction.price);
                            sellPointData.push(null);
                        } else {
                            sellPointData.push(transaction.price);
                            buyPointData.push(null);
                        }
                    } else {
                        buyPointData.push(null);
                        sellPointData.push(null);
                    }
                }
            }
            
            // éŠ·æ¯€ç¾æœ‰åœ–è¡¨å¯¦ä¾‹
            if (canvas.chart) {
                canvas.chart.destroy();
            }
            
            canvas.chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'è‚¡åƒ¹',
                            data: prices,
                            borderColor: realPriceData ? '#3b82f6' : '#f59e0b',
                            borderWidth: realPriceData ? 2 : 1,
                            borderDash: realPriceData ? [] : [5, 5],
                            tension: 0.3,
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'è²·å…¥é»',
                            data: buyPointData,
                            borderColor: 'transparent',
                            backgroundColor: '#ef4444',
                            pointRadius: 6,
                            pointStyle: 'circle',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            showLine: false
                        },
                        {
                            label: 'è³£å‡ºé»',
                            data: sellPointData,
                            borderColor: 'transparent',
                            backgroundColor: '#10b981',
                            pointRadius: 6,
                            pointStyle: 'circle',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            showLine: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('zh-TW', {
                                            style: 'currency',
                                            currency: card.market === 'us' ? 'USD' : 'HKD'
                                        }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: false,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            display: false,
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // é¡¯ç¤ºè©³ç´°èµ°å‹¢åœ–
        function showDetailedChart(symbol, name) {
            currentChartSymbol = symbol;
            document.getElementById('chartModalTitle').textContent = `${symbol} (${name}) è©³ç´°èµ°å‹¢åœ–`;
            
            // æ¸²æŸ“è©³ç´°åœ–è¡¨
            renderDetailedChart(symbol);
            
            // é¡¯ç¤ºäº¤æ˜“è¨˜éŒ„
            renderTransactionList(symbol);
            
            document.getElementById('chartModal').style.display = 'flex';
        }

        // æ¸²æŸ“è©³ç´°åœ–è¡¨
        function renderDetailedChart(symbol) {
            const canvas = document.getElementById('detailedChart');
            const ctx = canvas.getContext('2d');
            
            // éŠ·æ¯€ç¾æœ‰åœ–è¡¨
            if (detailedChart) {
                detailedChart.destroy();
            }
            
            // ç²å–è©²è‚¡ç¥¨çš„æ‰€æœ‰äº¤æ˜“è¨˜éŒ„
            const stockTransactions = stockCards
                .filter(c => c.symbol === symbol)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // ç²å–å¯¦éš›è‚¡åƒ¹æ•¸æ“š
            const realPriceData = stockPrices[symbol];
            
            let labels = [];
            let prices = [];
            let buyPointData = [];
            let sellPointData = [];
            
            if (realPriceData && realPriceData.history && realPriceData.history.length > 0) {
                // ä½¿ç”¨å¯¦éš›åƒ¹æ ¼æ•¸æ“š
                realPriceData.history.forEach((record, index) => {
                    labels.push(formatDate(record.date));
                    prices.push(record.price);
                    
                    // æª¢æŸ¥é€™å¤©æ˜¯å¦æœ‰äº¤æ˜“
                    const transaction = stockTransactions.find(t => 
                        t.date === record.date && 
                        (t.status === 'buy' || t.status === 'sell')
                    );
                    
                    if (transaction) {
                        if (transaction.status === 'buy') {
                            buyPointData[index] = transaction.price;
                            sellPointData[index] = null;
                        } else {
                            sellPointData[index] = transaction.price;
                            buyPointData[index] = null;
                        }
                    } else {
                        buyPointData[index] = null;
                        sellPointData[index] = null;
                    }
                });
            } else {
                // ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
                if (stockTransactions.length === 0) return;
                
                const firstDate = new Date(stockTransactions[0].date);
                const days = Math.min(90, Math.floor((new Date() - firstDate) / (1000 * 60 * 60 * 24)) + 30);
                
                let basePrice = stockTransactions[0].price || 100;
                let currentPrice = basePrice;
                
                for (let i = 0; i < days; i++) {
                    const date = new Date(firstDate);
                    date.setDate(date.getDate() + i);
                    labels.push(formatDate(date));
                    
                    // æª¢æŸ¥é€™å¤©æ˜¯å¦æœ‰äº¤æ˜“
                    const transactionDate = formatDate(date);
                    const transaction = stockTransactions.find(t => 
                        formatDate(new Date(t.date)) === transactionDate
                    );
                    
                    if (transaction) {
                        currentPrice = transaction.price;
                    } else {
                        // æ¨¡æ“¬åƒ¹æ ¼æ³¢å‹•
                        const change = (Math.random() * 0.04 - 0.02);
                        currentPrice = currentPrice * (1 + change);
                    }
                    
                    prices.push(currentPrice);
                    
                    // æ¨™è¨˜è²·è³£é»
                    if (transaction) {
                        if (transaction.status === 'buy') {
                            buyPointData.push(transaction.price);
                            sellPointData.push(null);
                        } else if (transaction.status === 'sell') {
                            sellPointData.push(transaction.price);
                            buyPointData.push(null);
                        } else {
                            buyPointData.push(null);
                            sellPointData.push(null);
                        }
                    } else {
                        buyPointData.push(null);
                        sellPointData.push(null);
                    }
                }
            }
            
            detailedChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: realPriceData ? 'å¯¦éš›è‚¡åƒ¹' : 'æ¨¡æ“¬è‚¡åƒ¹',
                            data: prices,
                            borderColor: realPriceData ? '#3b82f6' : '#f59e0b',
                            backgroundColor: realPriceData ? 'rgba(59, 130, 246, 0.1)' : 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            tension: 0.3,
                            fill: true,
                            pointRadius: 0
                        },
                        {
                            label: 'è²·å…¥é»',
                            data: buyPointData,
                            borderColor: 'transparent',
                            backgroundColor: '#ef4444',
                            pointRadius: 8,
                            pointStyle: 'circle',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            showLine: false
                        },
                        {
                            label: 'è³£å‡ºé»',
                            data: sellPointData,
                            borderColor: 'transparent',
                            backgroundColor: '#10b981',
                            pointRadius: 8,
                            pointStyle: 'circle',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            showLine: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('zh-TW', {
                                            style: 'currency',
                                            currency: stockTransactions[0]?.market === 'us' ? 'USD' : 'HKD'
                                        }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                maxTicksLimit: 10,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                },
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“äº¤æ˜“è¨˜éŒ„åˆ—è¡¨
        function renderTransactionList(symbol) {
            const transactions = stockCards
                .filter(c => c.symbol === symbol)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const container = document.getElementById('transactionList');
            container.innerHTML = transactions.map(transaction => `
                <div style="background: var(--bg-color); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid ${transaction.status === 'buy' ? 'var(--danger-color)' : 'var(--success-color)'}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="status-badge status-${transaction.status}" style="margin: 0;">
                                ${getStatusText(transaction.status)}
                            </span>
                            <span style="font-weight: 600; font-size: 16px; color: var(--text-primary);">
                                $${transaction.price.toFixed(2)}
                            </span>
                        </div>
                        <span style="font-size: 12px; color: var(--text-secondary);">
                            ${formatDate(transaction.date)}
                        </span>
                    </div>
                    <div style="font-size: 13px; color: var(--text-primary); line-height: 1.4;">
                        ${transaction.reason}
                    </div>
                    ${transaction.tags.length > 0 ? `
                    <div style="display: flex; gap: 5px; margin-top: 8px;">
                        ${transaction.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // æ›´æ–°åœ–è¡¨çš„å¯¦éš›åƒ¹æ ¼
        function updateRealPriceForChart() {
            showPriceUpdateModal(currentChartSymbol, '');
        }

        // é—œé–‰åœ–è¡¨æ¨¡æ…‹
        function closeChartModal() {
            document.getElementById('chartModal').style.display = 'none';
        }

        // é¡¯ç¤ºè‚¡åƒ¹èµ°å‹¢åœ–åˆ†é 
        function renderStockCharts(cards) {
            const container = document.getElementById('cardsGrid');
            const uniqueStocks = [...new Set(cards.map(card => card.symbol))];
            
            if (uniqueStocks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="empty-text">æ²’æœ‰è‚¡ç¥¨æ•¸æ“š</h3>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = uniqueStocks.map(symbol => {
                const stockCards = cards.filter(c => c.symbol === symbol);
                const stock = stockCards[0];
                const realPriceData = stockPrices[symbol];
                
                return `
                    <div class="stock-card fade-in">
                        <div class="card-header">
                            <div class="stock-info">
                                <div>
                                    <div class="stock-symbol">${symbol}</div>
                                    <div class="stock-name">${stock.name}</div>
                                </div>
                                <div class="market-badge badge-${stock.market}">
                                    ${stock.market === 'us' ? 'ç¾è‚¡' : 'æ¸¯è‚¡'}
                                </div>
                            </div>
                            ${realPriceData && realPriceData.currentPrice ? `
                            <div style="margin-top: 10px; font-size: 14px; color: ${realPriceData.change >= 0 ? 'var(--success-color)' : 'var(--danger-color)'}; font-weight: 600;">
                                $${realPriceData.currentPrice.toFixed(2)} (${realPriceData.change >= 0 ? '+' : ''}${realPriceData.change}%)
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="card-body">
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="summaryChart-${symbol}"></canvas>
                            </div>
                            <div class="chart-legend">
                                <div class="legend-item">
                                    <div class="legend-color legend-buy"></div>
                                    <span>è²·å…¥é»</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-sell"></div>
                                    <span>è³£å‡ºé»</span>
                                </div>
                                <div class="legend-item">
                                    <div style="width: 12px; height: 2px; background: #3b82f6;"></div>
                                    <span>å¯¦éš›è‚¡åƒ¹</span>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center;">
                                <button class="btn btn-primary" onclick="showDetailedChart('${symbol}', '${stock.name}')">
                                    <i class="fas fa-chart-line"></i> æŸ¥çœ‹è©³ç´°èµ°å‹¢
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // ç‚ºæ¯æ”¯è‚¡ç¥¨ç”Ÿæˆç¸½çµèµ°å‹¢åœ–
            uniqueStocks.forEach(symbol => {
                setTimeout(() => {
                    renderSummaryChart(symbol);
                }, 100);
            });
        }

        // æ¸²æŸ“ç¸½çµåœ–è¡¨
        function renderSummaryChart(symbol) {
            const canvas = document.getElementById(`summaryChart-${symbol}`);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const stockTransactions = stockCards.filter(c => c.symbol === symbol);
            
            // é‚è¼¯é¡ä¼¼æ–¼ renderDetailedChartï¼Œä½†ç°¡åŒ–é¡¯ç¤º
            // ... (ç”±æ–¼ç¯‡å¹…é™åˆ¶ï¼Œé€™è£¡çœç•¥å…·é«”å¯¦ç¾ï¼Œé‚è¼¯èˆ‡ renderDetailedChart é¡ä¼¼)
        }

        // æ¸²æŸ“æŠ•è³‡å›é¡§çµ±è¨ˆ
        function renderTimeStats() {
            const container = document.getElementById('timeStats');
            
            if (stockCards.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <div class="empty-text">æš«ç„¡çµ±è¨ˆæ•¸æ“š</div>
                    </div>
                `;
                return;
            }
            
            const now = new Date();
            let startDate, endDate;
            
            switch(currentTimeStats) {
                case 'daily':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                    break;
                case 'weekly':
                    const dayOfWeek = now.getDay();
                    const diff = now.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
                    startDate = new Date(now.getFullYear(), now.getMonth(), diff);
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 7);
                    break;
                case 'monthly':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 1);
                    break;
                case 'yearly':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    endDate = new Date(now.getFullYear() + 1, 0, 1);
                    break;
            }
            
            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const filteredCards = stockCards.filter(card => {
                const cardDate = new Date(card.date);
                return cardDate >= startDate && cardDate < endDate;
            });
            
            const buyCount = filteredCards.filter(c => c.status === 'buy').length;
            const sellCount = filteredCards.filter(c => c.status === 'sell').length;
            const watchCount = filteredCards.filter(c => c.status === 'watch').length;
            const discussCount = filteredCards.filter(c => c.status === 'discuss').length;
            
            const totalTransactions = buyCount + sellCount;
            const profitLoss = filteredCards.reduce((total, card) => {
                if (card.status === 'buy' && card.targetPrice > 0) {
                    return total + (card.targetPrice - card.price);
                } else if (card.status === 'sell' && card.price > 0) {
                    return total + card.price;
                }
                return total;
            }, 0);
            
            const mostTradedStock = filteredCards.reduce((acc, card) => {
                acc[card.symbol] = (acc[card.symbol] || 0) + 1;
                return acc;
            }, {});
            
            let topStock = 'ç„¡';
            let topStockCount = 0;
            Object.entries(mostTradedStock).forEach(([symbol, count]) => {
                if (count > topStockCount) {
                    topStock = symbol;
                    topStockCount = count;
                }
            });
            
            container.innerHTML = `
                <div class="stat-item">
                    <div class="stat-header">
                        <div class="stat-title">äº¤æ˜“æ•¸é‡</div>
                        <div class="stat-value">${totalTransactions}</div>
                    </div>
                    <div class="stat-details">
                        è²·å…¥: ${buyCount} | è³£å‡º: ${sellCount} | é—œæ³¨: ${watchCount} | è¨è«–: ${discussCount}
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-header">
                        <div class="stat-title">æç›Šä¼°ç®—</div>
                        <div class="stat-value ${profitLoss >= 0 ? 'positive' : 'negative'}">
                            ${profitLoss >= 0 ? '+' : ''}$${profitLoss.toFixed(2)}
                        </div>
                    </div>
                    <div class="stat-details">
                        åŸºæ–¼ç›®æ¨™åƒ¹æ ¼è¨ˆç®—çš„é ä¼°æç›Š
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-header">
                        <div class="stat-title">æœ€å¸¸äº¤æ˜“è‚¡ç¥¨</div>
                        <div class="stat-value neutral">${topStock}</div>
                    </div>
                    <div class="stat-details">
                        æœŸé–“å…§äº¤æ˜“ ${topStockCount} æ¬¡
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-header">
                        <div class="stat-title">æŠ•è³‡æƒ…ç·’</div>
                        <div class="stat-value neutral">
                            ${buyCount > sellCount ? 'æ¨‚è§€' : buyCount < sellCount ? 'ä¿å®ˆ' : 'ä¸­æ€§'}
                        </div>
                    </div>
                    <div class="stat-details">
                        è²·è³£æ¯”ä¾‹: ${buyCount}:${sellCount}
                    </div>
                </div>
            `;
        }

        // é¡¯ç¤ºæ™‚é–“çµ±è¨ˆ
        function showTimeStats(time) {
            currentTimeStats = time;
            document.querySelectorAll('.time-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.time-tab')[{
                'daily': 0,
                'weekly': 1,
                'monthly': 2,
                'yearly': 3
            }[time]].classList.add('active');
            renderTimeStats();
        }

        // æ¸²æŸ“ç•™è¨€æ¿
        function renderForumMessages() {
            const container = document.getElementById('messagesContainer');
            
            if (forumMessages.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <div class="empty-text">æš«ç„¡ç•™è¨€</div>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ™‚é–“æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            const sortedMessages = [...forumMessages].sort((a, b) => 
                new Date(b.createdAt) - new Date(a.createdAt)
            );
            
            container.innerHTML = sortedMessages.map(msg => `
                <div class="message-item">
                    <div class="message-header">
                        <div class="message-user">
                            <div class="user-avatar">
                                ${msg.userName.charAt(0).toUpperCase()}
                            </div>
                            <div class="user-info">
                                <div class="user-name">${msg.userName}</div>
                                <div class="user-location">${msg.userLocation}</div>
                            </div>
                        </div>
                        <div class="message-time">
                            ${formatDateTime(msg.createdAt)}
                        </div>
                    </div>
                    <div class="message-content">
                        ${msg.content}
                    </div>
                    ${msg.stockSymbol ? `
                    <div class="message-stock">
                        <i class="fas fa-chart-line"></i> ${msg.stockSymbol}
                    </div>
                    ` : ''}
                </div>
            `).join('');
            
            // æ»¾å‹•åˆ°åº•éƒ¨
            container.scrollTop = 0;
        }

        // æ·»åŠ æ–°ç•™è¨€
        function addNewMessage() {
            const content = document.getElementById('newMessage').value.trim();
            const userName = document.getElementById('userName').value.trim();
            const userLocation = document.getElementById('userLocation').value.trim();
            
            if (!content || !userName) {
                alert('è«‹å¡«å¯«ç•™è¨€å…§å®¹å’Œåå­—');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦æåˆ°äº†è‚¡ç¥¨ä»£è™Ÿ
            const stockMatch = content.match(/\b[A-Z]{1,5}\b/g);
            let stockSymbol = null;
            if (stockMatch) {
                // å˜—è©¦æ‰¾åˆ°æœ‰æ•ˆçš„è‚¡ç¥¨ä»£è™Ÿ
                stockSymbol = stockMatch.find(symbol => 
                    stockCards.some(card => card.symbol === symbol)
                );
            }
            
            const newMessage = {
                id: Date.now(),
                userName: userName,
                userLocation: userLocation || 'æœªçŸ¥åœ°å€',
                content: content,
                stockSymbol: stockSymbol || null,
                createdAt: new Date().toISOString()
            };
            
            forumMessages.unshift(newMessage);
            localStorage.setItem('forumMessages', JSON.stringify(forumMessages));
            
            // é‡æ–°æ¸²æŸ“ç•™è¨€
            renderForumMessages();
            updateStats();
            
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('newMessage').value = '';
            document.getElementById('userName').value = '';
            document.getElementById('userLocation').value = '';
            
            showNotification('ç•™è¨€å·²ç™¼å¸ƒï¼', 'success');
        }

        // é¡¯ç¤ºç•™è¨€æ¿
        function showForum() {
            // æ»¾å‹•åˆ°ç•™è¨€æ¿ä½ç½®
            document.querySelector('.forum-card').scrollIntoView({ behavior: 'smooth' });
        }

        // ç¯©é¸å°å¡
        function filterCards() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterMarket = document.getElementById('filterMarket').value;
            const filterStatus = document.getElementById('filterStatus').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            let filtered = stockCards;
            
            // æœç´¢ç¯©é¸
            if (searchTerm) {
                filtered = filtered.filter(card => 
                    card.symbol.toLowerCase().includes(searchTerm) ||
                    card.name.toLowerCase().includes(searchTerm) ||
                    card.reason.toLowerCase().includes(searchTerm) ||
                    card.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                );
            }
            
            // å¸‚å ´ç¯©é¸
            if (filterMarket !== 'all') {
                filtered = filtered.filter(card => card.market === filterMarket);
            }
            
            // ç‹€æ…‹ç¯©é¸
            if (filterStatus !== 'all') {
                filtered = filtered.filter(card => card.status === filterStatus);
            }
            
            // æ—¥æœŸç¯„åœç¯©é¸
            if (dateFrom) {
                filtered = filtered.filter(card => new Date(card.date) >= new Date(dateFrom));
            }
            if (dateTo) {
                filtered = filtered.filter(card => new Date(card.date) <= new Date(dateTo));
            }
            
            renderCards(filtered);
        }

        // é‡ç½®ç¯©é¸
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterMarket').value = 'all';
            document.getElementById('filterStatus').value = 'all';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('sortBy').value = 'date_desc';
            
            currentTab = 'all';
            updateTabs();
            renderCards();
        }

        // é¡¯ç¤ºåˆ†é 
        function showTab(tab) {
            currentTab = tab;
            updateTabs();
            renderCards();
        }

        // æ›´æ–°åˆ†é ç‹€æ…‹
        function updateTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const tabIndex = {
                'all': 0,
                'buy': 1,
                'sell': 2,
                'watch': 3,
                'discuss': 4,
                'chart': 5
            }[currentTab];
            
            if (tabIndex !== undefined) {
                document.querySelectorAll('.tab')[tabIndex].classList.add('active');
            }
        }

        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        function updateStats() {
            // è¨ˆç®—å„å¸‚å ´æ•¸é‡
            const usCount = stockCards.filter(card => card.market === 'us').length;
            const hkCount = stockCards.filter(card => card.market === 'hk').length;
            
            // æ›´æ–°é¡¯ç¤º
            document.getElementById('usCount').textContent = usCount;
            document.getElementById('hkCount').textContent = hkCount;
            document.getElementById('messageCount').textContent = forumMessages.length;
        }

        // æ·»åŠ ç¤ºä¾‹æ•¸æ“š
        function addSampleData() {
            const sampleStocks = [
                {
                    id: Date.now() - 100000,
                    market: 'us',
                    symbol: 'AAPL',
                    name: 'è˜‹æœå…¬å¸',
                    status: 'buy',
                    price: 175.50,
                    targetPrice: 200.00,
                    targetUp: 15,
                    targetDown: 5,
                    progress: 14,
                    date: '2024-03-15',
                    reason: 'AIåŠŸèƒ½å³å°‡åœ¨iOS 18æ¨å‡ºï¼Œé è¨ˆå¸¶å‹•æ›æ©Ÿæ½®ã€‚æœå‹™æ”¶å…¥æŒçºŒå¢é•·ï¼Œç¾é‡‘æµå¼·å‹ã€‚',
                    tags: ['ç§‘æŠ€è‚¡', 'é•·æœŸæŠ•è³‡', 'AIæ¦‚å¿µ'],
                    createdAt: '2024-03-15T10:30:00Z',
                    updatedAt: '2024-03-15T10:30:00Z'
                },
                {
                    id: Date.now() - 200000,
                    market: 'us',
                    symbol: 'NVDA',
                    name: 'NVIDIA è¼é”',
                    status: 'sell',
                    price: 950.25,
                    targetPrice: 850.00,
                    targetUp: 0,
                    targetDown: 10,
                    progress: 12,
                    date: '2024-03-12',
                    reason: 'è‚¡åƒ¹æ¼²å¹…éå¤§ï¼Œå…ˆè¡Œç²åˆ©äº†çµã€‚ç­‰å¾…å›èª¿å†è²·å…¥ã€‚',
                    tags: ['AIæ¦‚å¿µ', 'ç²åˆ©äº†çµ'],
                    createdAt: '2024-03-12T09:15:00Z',
                    updatedAt: '2024-03-12T09:15:00Z'
                },
                {
                    id: Date.now() - 300000,
                    market: 'hk',
                    symbol: '0700',
                    name: 'é¨°è¨Šæ§è‚¡',
                    status: 'watch',
                    price: 285.00,
                    targetPrice: 320.00,
                    targetUp: 12,
                    targetDown: 8,
                    progress: 0,
                    date: '2024-03-10',
                    reason: 'éŠæˆ²æ¥­å‹™å¾©ç”¦ï¼Œå»£å‘Šæ”¶å…¥å¢é•·ã€‚ç­‰å¾…æ›´å¥½è²·å…¥æ™‚æ©Ÿã€‚',
                    tags: ['ç§‘æŠ€è‚¡', 'åƒ¹å€¼æŠ•è³‡'],
                    createdAt: '2024-03-10T14:20:00Z',
                    updatedAt: '2024-03-10T14:20:00Z'
                }
            ];
            
            const sampleMessages = [
                {
                    id: Date.now() - 400000,
                    userName: 'æŠ•è³‡é”äºº',
                    userLocation: 'é¦™æ¸¯',
                    content: 'AAPLæœ€è¿‘è¡¨ç¾ä¸éŒ¯ï¼ŒAIåŠŸèƒ½å€¼å¾—æœŸå¾…ï¼å¤§å®¶æ€éº¼çœ‹ï¼Ÿ',
                    stockSymbol: 'AAPL',
                    createdAt: '2024-03-14T15:30:00Z'
                },
                {
                    id: Date.now() - 500000,
                    userName: 'ç¾è‚¡æ–°æ‰‹',
                    userLocation: 'å°ç£',
                    content: 'å‰›é–‹å§‹æŠ•è³‡ç¾è‚¡ï¼Œæœ‰ä»€éº¼æ¨è–¦çš„å…¥é–€è‚¡ç¥¨å—ï¼Ÿ',
                    stockSymbol: null,
                    createdAt: '2024-03-13T11:20:00Z'
                },
                {
                    id: Date.now() - 600000,
                    userName: 'åƒ¹å€¼æŠ•è³‡è€…',
                    userLocation: 'æ–°åŠ å¡',
                    content: '0700ç¾åœ¨çš„åƒ¹ä½å¾ˆæœ‰å¸å¼•åŠ›ï¼Œæº–å‚™åˆ†æ‰¹è²·å…¥ã€‚',
                    stockSymbol: '0700',
                    createdAt: '2024-03-12T09:45:00Z'
                }
            ];
            
            const samplePrices = {
                'AAPL': {
                    currentPrice: 178.25,
                    change: 1.57,
                    lastUpdated: '2024-03-15',
                    history: [
                        { price: 175.50, date: '2024-03-14', source: 'yahoo' },
                        { price: 177.80, date: '2024-03-13', source: 'google' },
                        { price: 178.25, date: '2024-03-15', source: 'bloomberg' }
                    ]
                },
                'NVDA': {
                    currentPrice: 945.80,
                    change: -0.47,
                    lastUpdated: '2024-03-15',
                    history: [
                        { price: 950.25, date: '2024-03-14', source: 'yahoo' },
                        { price: 942.30, date: '2024-03-13', source: 'google' },
                        { price: 945.80, date: '2024-03-15', source: 'bloomberg' }
                    ]
                }
            };
            
            if (stockCards.length === 0) {
                stockCards = sampleStocks;
                forumMessages = sampleMessages;
                stockPrices = samplePrices;
            } else {
                if (confirm('ç•¶å‰å·²æœ‰æ•¸æ“šï¼Œæ˜¯å¦è¦æ·»åŠ ç¤ºä¾‹æ•¸æ“šï¼Ÿ')) {
                    stockCards = [...stockCards, ...sampleStocks];
                    forumMessages = [...forumMessages, ...sampleMessages];
                    stockPrices = { ...stockPrices, ...samplePrices };
                }
            }
            
            saveToLocalStorage();
            localStorage.setItem('forumMessages', JSON.stringify(forumMessages));
            localStorage.setItem('stockPrices', JSON.stringify(stockPrices));
            
            renderCards();
            renderForumMessages();
            renderTimeStats();
            updateStats();
            
            showNotification('ç¤ºä¾‹æ•¸æ“šå·²æ·»åŠ ï¼', 'success');
        }

        // è¼”åŠ©å‡½æ•¸
        function getStatusText(status) {
            const statusMap = {
                'buy': 'è²·å…¥',
                'sell': 'è³£å‡º',
                'watch': 'é—œæ³¨ä¸­',
                'discuss': 'è¨è«–ä¸­'
            };
            return statusMap[status] || status;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-TW', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('zh-TW', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function saveToLocalStorage() {
            localStorage.setItem('stockCards', JSON.stringify(stockCards));
        }

        function showNotification(message, type = 'info') {
            // å‰µå»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                z-index: 9999;
                animation: slideIn 0.3s ease;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                display: flex;
                align-items: center;
                gap: 10px;
                max-width: 300px;
            `;
            
            // æ ¹æ“šé¡å‹è¨­ç½®é¡è‰²
            const colors = {
                'success': '#10b981',
                'warning': '#f59e0b',
                'error': '#ef4444',
                'info': '#3b82f6'
            };
            
            notification.style.background = colors[type] || colors.info;
            
            // æ·»åŠ åœ–æ¨™
            const icons = {
                'success': 'check-circle',
                'warning': 'exclamation-triangle',
                'error': 'times-circle',
                'info': 'info-circle'
            };
            
            notification.innerHTML = `
                <i class="fas fa-${icons[type]}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // 3ç§’å¾Œè‡ªå‹•ç§»é™¤
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ç·¨è¼¯ã€åˆªé™¤ç­‰åŠŸèƒ½ä¿æŒä¸è®Šï¼ˆç”±æ–¼ç¯‡å¹…é™åˆ¶ï¼Œé€™è£¡çœç•¥ï¼‰
        // ... [å…¶ä»–å‡½æ•¸ä¿æŒä¸è®Š]
    </script>
</body>
</html>